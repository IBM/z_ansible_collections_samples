- name: sample of identifying missing critical software updates for a software instance
  hosts: all
  gather_facts: no
  collections:
    - ibm.ibm_zosmf

  tasks:
    #####################################################################################
    # PLAY #1: Retrieve all SW Instances                                                #
    #####################################################################################
    - ansible.builtin.uri:
        url: "https://{{ zmf_host }}:{{ zmf_port }}/zosmf/swmgmt/pswi"
        method: GET
        user: "{{ zmf_user | trim }}"
        password: "{{ zmf_password | trim }}"
        force_basic_auth: true
        headers:
          Host: "{{ zmf_host }}"
          Origin: "https://{{ zmf_host }}"
        status_code: "200"
        validate_certs: false
        return_content: true
      register: instance_data
      delegate_to: localhost

    #####################################################################################
    # PLAY #2: Identify missing critical software updates for each SW Instance          #
    #####################################################################################
    - name: Identify Missing Critical Software Updates
      ansible.builtin.include_role:
        name: zmf_swmgmt_identify_missing_critical_updates

    #####################################################################################
    # PLAY #3: Identify missing fixcat software updates for each SW Instance            #
    #####################################################################################
    - name: Identify Missing Fixcat Software Updates
      ansible.builtin.include_role:
            name: zmf_swmgmt_identify_missing_fixcat_updates
            
    #####################################################################################
    # PLAY #4: Search SW Instance for software updates.                                 #
    #####################################################################################
    - name: Search for Software Updates
      ansible.builtin.include_role:
            name: zmf_swmgmt_search_software_updates